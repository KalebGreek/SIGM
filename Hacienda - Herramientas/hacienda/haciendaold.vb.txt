Public Class consultas
    '###### VARIABLES #######################################################################################
    Dim cuota_vence As Integer


    Private Sub consultas_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        info.Text = "Iniciando.."
        read_config()
        load_progress.Value = 10

        'Formatear tabla dtab_deto
        dtab_deto.Columns.Add("codigo") '0
        dtab_deto.Columns.Add("razon") '1
        dtab_deto.Columns.Add("deudatotal") '2
        dtab_deto.Columns.Add("ultimovencio") '3
        dtab_deto.Columns.Add("ultimopago") '4
        load_progress.Value = 20

        'El menú se desbloquea recién cuando se leyeron todas las tablas
        CálculoDeDeudasToolStripMenuItem.Enabled = True
        EstadísticasToolStripMenuItem.Enabled = True
        OpcionesToolStripMenuItem.Enabled = True
        info.Text = "Última Consulta:"
    End Sub
    '###### FIN VARIABLES ###################################################################################
    '###### GUI #############################################################################################
    Private Sub AguaToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AguaToolStripMenuItem.Click
        control1.Visible = True
        control1.SelectTab(0)
        info.Text = "Leyendo datos.."
        reset_agua()
        load_progress.Value = 10
        read_ext()
        load_progress.Value = 20
        info.Text = "Última Consulta:"
    End Sub
    Private Sub CatastroToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CatastroToolStripMenuItem.Click
        control1.Visible = True
        control1.SelectTab(1)
        reset_cata()
    End Sub
    Private Sub ComercioToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ComercioToolStripMenuItem.Click
        control1.Visible = True
        control1.SelectTab(2)
        'reset_come()
    End Sub
    Private Sub SepelioToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles SepelioToolStripMenuItem.Click
        control1.Visible = True
        control1.SelectTab(3)
        'reset_sepe()
    End Sub
    Private Sub VehículosToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles VehículosToolStripMenuItem.Click
        control1.Visible = True
        control1.SelectTab(4)
        'reset_vehi()
    End Sub

    Private Sub control1_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles control1.Click
        If control1.SelectedIndex = 0 Then 'Agua
            reset_agua()
        ElseIf control1.SelectedIndex = 1 Then 'Catastro
            reset_cata()
        ElseIf control1.SelectedIndex = 2 Then 'Comercio
            'reset_come()
        ElseIf control1.SelectedIndex = 3 Then 'Sepelio
            'reset_sepe()
        ElseIf control1.SelectedIndex = 4 Then 'Vehículos
            'reset_vehi()
        End If
    End Sub
    Private Sub control1_VisibleChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles control1.VisibleChanged
        With control1
            '-----------------
            tabla_consulta.Visible = .Visible
            et_deuda.Visible = .Visible
            sub_deuda.Visible = .Visible
            et_pago.Visible = .Visible
            sub_pago.Visible = .Visible
            et_total.Visible = .Visible
            total_deuda.Visible = .Visible
            imprimir_consulta.Visible = .Visible
            vistaprevia_consulta.Visible = .Visible
        End With
    End Sub
    Private Sub cleandesk()
        control1.Visible = False
        '-----------------
        tabla_consulta.Visible = False
        et_deuda.Visible = False
        et_pago.Visible = False
        et_total.Visible = False
    End Sub

    Private Sub ConfiguraciónToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ConfiguraciónToolStripMenuItem.Click
        config.Show()
        Me.Hide()
    End Sub
    Private Sub SalirToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles SalirToolStripMenuItem.Click
        End
    End Sub
    '#### PESTAÑA AGUA ##########################################################
    Private Sub reset_agua()
        '## RESET GENERAL
        mostrar_filtro1.Checked = False
        filtro1_opcion1.SelectedIndex = 0
        mostrar_filtro1b.Checked = False

        mostrar_filtro2.Checked = False
        filtro2_año1.Value = Today.Year
        filtro2_año2.Value = Today.Year

        mostrar_filtro3.Checked = False
        filtro3_opcion.SelectedIndex = 0

        mostrar_filtro4.Checked = False
    End Sub

    '--------------------------
    Private Sub mostrar_filtro1_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mostrar_filtro1.CheckedChanged
        With mostrar_filtro1
            filtro1_opcion1.Enabled = .Checked
            mostrar_filtro1b.Enabled = .Checked
        End With
    End Sub
    Private Sub filtro1_opcion1_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles filtro1_opcion1.SelectedIndexChanged
        mostrar_filtro1b.Checked = False
        If filtro1_opcion1.SelectedIndex = 0 Then
            filtro1_opcion1.ForeColor = Color.Red
        ElseIf filtro1_opcion1.SelectedIndex = 1 Then
            filtro1_opcion1.ForeColor = Color.Green
        End If
    End Sub
    Private Sub filtro1_opcion2_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles filtro1_opcion2.SelectedIndexChanged
        read_ext()
    End Sub
    Private Sub mostrar_filtro1b_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mostrar_filtro1b.CheckedChanged
        With mostrar_filtro1b
            filtro1b_opcion1.Enabled = .Checked
            filtro1b_desde.Visible = .Checked
            agua_et_desde.Visible = .Checked
            agua_et_hasta.Visible = .Checked
            filtro1b_hasta.Visible = .Checked
            'Deshabilitar
            If .Checked = True Then
                mostrar_filtro2.Enabled = False 'Filtrar por año deshabilitado
                mostrar_filtro2.Checked = False
                mostrar_filtro4.Enabled = False 'Filtrar por rubro deshabilitado
                mostrar_filtro4.Checked = False
            Else
                mostrar_filtro2.Enabled = True
                mostrar_filtro4.Enabled = True
            End If
        End With
    End Sub
    Private Sub filtro1b_opcion1_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles filtro1b_opcion1.SelectedIndexChanged
        If filtro1b_opcion1.SelectedIndex = 2 Then
            filtro1b_hasta.Enabled = True
        Else
            filtro1b_hasta.Enabled = False
        End If
    End Sub
    Private Sub filtro1b_desde_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles filtro1b_desde.ValueChanged
        With filtro1b_desde
            If .Value > filtro1b_hasta.Value Then
                filtro1b_hasta.Value = .Value
            End If
        End With
    End Sub
    Private Sub filtro1b_hasta_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles filtro1b_hasta.ValueChanged
        With filtro1b_hasta
            If filtro1b_desde.Value > .Value Then
                filtro1b_desde.Value = .Value
            End If
        End With
    End Sub
    '--------------------------
    Private Sub agua_mostrar_filtro2_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mostrar_filtro2.CheckedChanged
        With mostrar_filtro2
            filtro2_año1.Enabled = .Checked
            filtro2_año2.Enabled = .Checked
            grupo_cuotas.Visible = .Checked
            cuotas_todo.Checked = True
        End With
    End Sub

    Private Sub agua_cuotas_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cuotas_todo.CheckedChanged
        cuota_vence = 0
    End Sub
    Private Sub agua_cuota5_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cuota5.CheckedChanged
        cuota_vence = 5
    End Sub
    Private Sub agua_cuota6_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cuota6.CheckedChanged
        cuota_vence = 6
    End Sub
    Private Sub agua_cuota1_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cuota1.CheckedChanged
        cuota_vence = 1
    End Sub
    Private Sub agua_cuota2_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cuota2.CheckedChanged
        cuota_vence = 2
    End Sub
    Private Sub agua_cuota3_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cuota3.CheckedChanged
        cuota_vence = 3
    End Sub
    Private Sub agua_cuota4_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cuota4.CheckedChanged
        cuota_vence = 4
    End Sub
    '--------------------------
    Private Sub agua_mostrar_filtro3_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mostrar_filtro3.CheckedChanged
        With mostrar_filtro3
            filtro3_opcion.Enabled = .Checked
            personas.Enabled = .Checked
            '--------------------------------
            et_agua_key.Visible = .Checked
            filtro3_razon.Visible = .Checked
            filtro3_codigo.Visible = .Checked
        End With
    End Sub
    Private Sub agua_filtro3_opcion_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles filtro3_opcion.SelectedIndexChanged
        If filtro3_opcion.SelectedIndex = 0 Then
            filtro3_razon.Enabled = True
            filtro3_codigo.Enabled = False
        ElseIf filtro3_opcion.SelectedIndex = 1 Then
            filtro3_razon.Enabled = False
            filtro3_codigo.Enabled = True
        End If
    End Sub
    '--------------------------
    Private Sub agua_mostrar_filtro4_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles mostrar_filtro4.CheckedChanged
        With mostrar_filtro4
            filtro4_res.Enabled = .Checked
            filtro4_com.Enabled = .Checked
            filtro4_ind.Enabled = .Checked
        End With
    End Sub
    '--------------------------
    Private Sub agua_cerrar_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cerrar.Click
        control1.Visible = False
    End Sub

    '#### PESTAÑA CATASTRO ######################################################
    Private Sub reset_cata()
        '## RESET GENERAL
        'cata_mostrar_filtro1.Checked = False
        'cata_filtro1_opcion.SelectedIndex = 0
        'cata_filtro1_año.Value = Today.Year

        'cata_mostrar_filtro2.Checked = False
        'cata_filtro2_opcion.SelectedIndex = 0
        'cata_personas.Text = config.ext_cata_personas.Text
    End Sub

    '#### PESTAÑA COMERCIO ######################################################
    '#### PESTAÑA SEPELIO #######################################################
    '#### PESTAÑA VEHICULO# #####################################################

    '###### FIN GUI #############################################################################################
    '------------------------------------------------------------------------------------------------------------
    '###### FILTER ##############################################################################################

    '#### PESTAÑA AGUA ##########################################################
    '#### FILTROS AUTOMATICOS ################################
    Private Sub agua_vencimientos()
        '## VENCIMIENTOS
        If filtro2_año1.Value = filtro2_año2.Value Then
            sel_sql = "SELECT * FROM aguvence WHERE periodo=" & filtro2_año1.Value
            leer_bd()
            If dtab.Rows.Count > 0 Then
                vence1.Text = dtab(0)("vence1")
                vence2.Text = dtab(0)("vence2")
                vence3.Text = dtab(0)("vence3")
                vence4.Text = dtab(0)("vence4")
                vence5.Text = dtab(0)("vence5")
                vence6.Text = dtab(0)("vence6")
            End If
        Else
            vence1.Text = "No hay datos"
            vence2.Text = "No hay datos"
            vence3.Text = "No hay datos"
            vence4.Text = "No hay datos"
            vence5.Text = "No hay datos"
            vence6.Text = "No hay datos"
        End If
    End Sub
    Private Sub agua_filtro2_año1_ValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles filtro2_año1.ValueChanged
        If filtro2_año1.Value > filtro2_año2.Value Then
            filtro2_año1.Value -= 1
        End If
        agua_vencimientos()
    End Sub
    Private Sub agua_filtro2_año2_ValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles filtro2_año2.ValueChanged
        If filtro2_año1.Value > filtro2_año2.Value Then
            filtro2_año2.Value += 1
        End If
        agua_vencimientos()
    End Sub

    Private Sub agua_filtro3_razon_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles filtro3_razon.SelectedIndexChanged
        With filtro3_razon
            If .SelectedIndex > 0 Then
                filtro3_codigo.SelectedIndex = .SelectedIndex
            End If
        End With
    End Sub
    Private Sub agua_filtro2_codigo_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles filtro3_codigo.SelectedIndexChanged
        With filtro3_codigo
            If .SelectedIndex > 0 Then
                filtro3_razon.SelectedIndex = .SelectedIndex
            End If
        End With
    End Sub

    '#### FILTROS MANUALES ################################
    Private Sub agua_consulta()
        tabla_consulta.DataSource = Nothing
        bs_consulta.DataSource = Nothing
        dtab_con.Clear()
        '### Crear consulta sin filtros
        sel_sql = "SELECT periodo, mes, codigo, original, vencio, pagado, pago, agrupado, reside, comercio, industria, original-pagado as deuda FROM " & config.ext_agua_cuentas.Text

        If mostrar_filtro1b.Checked = False Then  'Consulta especial que muestra deudas totales
            '### Hay otros filtros activos?
            If mostrar_filtro1.Checked = True Or mostrar_filtro2.Checked = True _
            Or mostrar_filtro3.Checked = True Or mostrar_filtro4.Checked = True Then
                'Para imprimir solo consultas personalizadas
                imprimir_consulta.Enabled = True

                sel_sql += " WHERE"

                '### Opción deudor/sin deuda
                If mostrar_filtro1.Checked = True Then
                    If filtro1_opcion1.SelectedIndex = 0 Then
                        sel_sql += " pagado<original AND"
                    Else
                        sel_sql += " pagado=>original AND"
                    End If
                End If
                '### Rango de años o único año?
                If mostrar_filtro2.Checked = True Then
                    If filtro2_año1.Value = filtro2_año2.Value Then
                        sel_sql += " periodo=" & filtro2_año1.Value & " AND"
                    Else
                        sel_sql += " periodo=>" & filtro2_año1.Value & " AND periodo<=" & filtro2_año2.Value & " AND"
                    End If
                    '### Hay cuotas seleccionadas?
                    If cuota_vence > 0 Then
                        sel_sql += " mes=" & cuota_vence & " AND"
                    End If
                End If
                '### Contribuyente específico?
                If mostrar_filtro3.Checked = True Then
                    sel_sql += " codigo=" & filtro3_codigo.Text & " AND"
                End If
                '### Sector específico?
                If mostrar_filtro4.Checked = True Then
                    If filtro4_res.Checked = True Then
                        sel_sql += " reside>0 AND comercio=0 AND industria=0 AND"
                    ElseIf filtro4_com.Checked = True Then
                        sel_sql += " reside=0 AND comercio>0 AND industria=0 AND"
                    Else
                        sel_sql += " reside=0 AND comercio=0 AND industria>0 AND"
                    End If
                End If
                'Esta línea quita el último AND de la consulta
                sel_sql = Microsoft.VisualBasic.Left(sel_sql, Len(sel_sql) - 4)
                sel_sql += " ORDER BY codigo"
            End If
            leer_bd()
            dtab_con.Merge(dtab)
            bs_consulta.DataSource = dtab_con
        Else
            info.Text = "Esto puede tardar varios minutos."
            deto_agua() 'Se debe calcular cada vez que se realizan cambios en la bd
            bs_consulta.DataSource = dtab_deto

            'Resetear barra de progreso
            load_progress.Minimum = 1
            load_progress.Value = 1
            load_progress.Maximum = 20
        End If
        mostrar_consulta()
    End Sub

    Private Sub agua_buscar_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles buscar.Click
        agua_consulta()
    End Sub
    Private Sub agua_filtro1_desde_KeyPress(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyPressEventArgs) Handles filtro1b_desde.KeyPress
        If e.KeyChar = Chr(13) Then
            agua_consulta()
        End If
    End Sub
    Private Sub agua_filtro3_razon_KeyPress(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyPressEventArgs) Handles filtro3_razon.KeyPress
        If e.KeyChar = Chr(13) Then
            agua_consulta()
        End If
    End Sub
    Private Sub agua_filtro3_codigo_KeyPress(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyPressEventArgs) Handles filtro3_codigo.KeyPress
        If e.KeyChar = Chr(13) Then
            agua_consulta()
        End If
    End Sub

    '#### PESTAÑA CATASTRO ######################################################
    '#### FILTROS AUTOMATICOS ###############################

    '#### FILTROS MANUALES ################################

    '#### PESTAÑA CATASTRO ######################################################

    '#### PESTAÑA CATASTRO ######################################################

    '#### PESTAÑA CATASTRO ######################################################

    '###### END FILTER ##########################################################################################
    '###### PRINT ###############################################################################################
    Private Sub consulta_printdocument_PrintPage(ByVal sender As System.Object, ByVal e As System.Drawing.Printing.PrintPageEventArgs) Handles consulta_printdocument.PrintPage
        'Variables de impresión
        'Control de hojas
        Dim minrow, maxrow, hoja As Integer
        'Datos del contribuyente
        Dim dato_ubic, dato_cata, _
           dato_contrib, dato_cuil, _
           dato_calle, dato_agrupado, _
           dato_tel, dato_impuesto As String
        'Tipos de letra
        Dim fuente_h1 As New  _
        Font("Segoe UI", 16, FontStyle.Bold)
        Dim fuente_desc_regular As New  _
        Font("Segoe UI", 12, FontStyle.Regular)
        Dim fuente_desc_cursiva As New  _
        Font("Segoe UI", 12, FontStyle.Italic)
        Dim fuente_desc_negrita As New  _
        Font("Segoe UI", 12, FontStyle.Bold)
        Dim fuente_tabla_regular As New  _
        Font("Consolas", 10, FontStyle.Regular)
        Dim fuente_tabla_negrita As New  _
        Font("Consolas", 10, FontStyle.Bold)
        Dim abs_x, abs_y As Integer
        'Tipos de trazo
        Dim trazo_grueso As New Pen(Color.Black, 5)
        Dim trazo_normal As New Pen(Color.Black, 2)

        'Leer datos de contribuyente según servicio
        With bs_personas
            dato_ubic = .Item(.Position)("ubicacion")
            dato_cata = .Item(.Position)("catastro")
            dato_contrib = .Item(.Position)("razon")
            dato_cuil = 0 'se debería leer desde la cuenta agrupada
            dato_calle = .Item(.Position)("calle")
            dato_agrupado = 0 'se debería leer desde la cuenta agrupada
            dato_tel = 0 'se debería leer desde la cuenta agrupada
        End With
        If control1.SelectedIndex() = 0 Then 'AGUA
            dato_impuesto = "DE AGUA"
        ElseIf control1.SelectedIndex() = 1 Then 'CATASTRO
            dato_impuesto = "DE CATASTRO"
        ElseIf control1.SelectedIndex() = 2 Then 'COMERCIO
            dato_impuesto = "DE COMERCIO"
        ElseIf control1.SelectedIndex() = 3 Then 'SEPELIO
            dato_impuesto = "DE SEPELIO"
        ElseIf control1.SelectedIndex() = 4 Then 'VEHÍCULO
            dato_impuesto = "DE VEHÍCULO"
        ElseIf control1.Visible = False Then 'CUENTA AGRUPADA
            dato_impuesto = "POR CUENTA AGRUPADA"
        End If
        maxrow = tabla_consulta.RowCount - 1
        Do 'For para repetir hojas

            '=========================
            e.Graphics.DrawRectangle(Pens.Black, 10, 10, 780, 1020)
            'CONSULTA IMPUESTO ----- FECHA
            e.Graphics.DrawString("CONSULTA IMPUESTO " & dato_impuesto, fuente_h1, Brushes.Black, 13, 10) 'Título
            e.Graphics.DrawString("FECHA: " & Date.Today.ToShortDateString, fuente_h1, Brushes.Black, 543, 10) 'Fecha
            '=========================
            e.Graphics.DrawLine(trazo_grueso, 10, 40, 790, 40)
            'ubicacion ------ catastro
            e.Graphics.DrawString("UBICACIÓN: ", fuente_desc_negrita, Brushes.Black, 11, 42)
            e.Graphics.DrawString(dato_ubic, fuente_desc_regular, Brushes.Black, 111, 42)
            e.Graphics.DrawString("CATASTRO: ", fuente_desc_negrita, Brushes.Black, 501, 42)
            e.Graphics.DrawString(dato_cata, fuente_desc_regular, Brushes.Black, 596, 42)
            'contribuyente ----- cuil
            e.Graphics.DrawString("CONTRIBUYENTE: ", fuente_desc_negrita, Brushes.Black, 11, 62)
            e.Graphics.DrawString(dato_contrib, fuente_desc_regular, Brushes.Black, 156, 62)
            e.Graphics.DrawString("CUIL: ", fuente_desc_negrita, Brushes.Black, 501, 62)
            e.Graphics.DrawString(dato_cuil, fuente_desc_regular, Brushes.Black, 546, 62)
            'dirección ----- cuenta agrupada
            e.Graphics.DrawString("CALLE: ", fuente_desc_negrita, Brushes.Black, 11, 82)
            e.Graphics.DrawString(dato_calle, fuente_desc_regular, Brushes.Black, 71, 82)
            e.Graphics.DrawString("CTA. AGRUPADA: ", fuente_desc_negrita, Brushes.Black, 501, 82)
            e.Graphics.DrawString(dato_agrupado, fuente_desc_regular, Brushes.Black, 641, 82)
            'teléfono ----- hoja
            e.Graphics.DrawString("TELÉFONO: ", fuente_desc_negrita, Brushes.Black, 11, 102)
            e.Graphics.DrawString(dato_agrupado, fuente_desc_regular, Brushes.Black, 101, 102)
            e.Graphics.DrawString("HOJA Nº ", fuente_desc_negrita, Brushes.Black, 501, 102)
            e.Graphics.DrawString(hoja, fuente_desc_regular, Brushes.Black, 576, 102)
            '=========================
            e.Graphics.DrawLine(trazo_grueso, 10, 124, 790, 124)

            'dibujar tabla de datos
            'límites 10 a 790 en X  
            '120 a 1000 en Y (las dos líneas gruesas)
            For abs_x = 10 To 780 Step 5 'Recorre x (de izquierda a derecha)
                abs_y = 120
                fila = 0

                For abs_y = 120 To 1020 Step 5 'Recorre y (de arriba hacia abajo)
                    If abs_y = 120 Then 'Líneas de separación por columnas
                    End If
                    If abs_y = 125 Then 'Cabeceras
                        If abs_x = 10 Then
                            e.Graphics.DrawString("Período/Cuota", fuente_tabla_negrita, Brushes.Black, abs_x, abs_y)
                        ElseIf abs_x = 130 Then
                            e.Graphics.DrawString("Vencimiento", fuente_tabla_negrita, Brushes.Black, abs_x, abs_y)
                        ElseIf abs_x = 250 Then
                            e.Graphics.DrawString("Monto Original", fuente_tabla_negrita, Brushes.Black, abs_x, abs_y)
                        ElseIf abs_x = 410 Then
                            e.Graphics.DrawString("Recargo por Mora", fuente_tabla_negrita, Brushes.Black, abs_x, abs_y)
                        ElseIf abs_x = 670 Then
                            e.Graphics.DrawString("Monto a Pagar", fuente_tabla_negrita, Brushes.Black, abs_x, abs_y)
                        End If
                    End If
                    If abs_y = 145 Then 'Línea de separación de cabecera
                        If abs_x = 10 Then
                            e.Graphics.DrawLine(trazo_normal, abs_x, abs_y, 790, abs_y)
                        End If
                    End If
                    If fila <= maxrow Then 'Datos
                        If abs_y = 150 Or abs_y = 170 Or abs_y = 190 Or abs_y = 210 _
                        Or abs_y = 230 Or abs_y = 250 Or abs_y = 270 Or abs_y = 290 _
                        Or abs_y = 310 Or abs_y = 330 Or abs_y = 350 Or abs_y = 370 _
                        Or abs_y = 390 Or abs_y = 410 Or abs_y = 430 Or abs_y = 450 _
                        Or abs_y = 470 Or abs_y = 490 Or abs_y = 510 Or abs_y = 530 _
                        Or abs_y = 550 Or abs_y = 570 Or abs_y = 590 Or abs_y = 610 _
                        Or abs_y = 630 Or abs_y = 650 Or abs_y = 670 Or abs_y = 690 _
                        Or abs_y = 710 Or abs_y = 730 Or abs_y = 750 Or abs_y = 770 _
                        Or abs_y = 790 Or abs_y = 810 Or abs_y = 830 Or abs_y = 850 _
                        Or abs_y = 870 Or abs_y = 890 Or abs_y = 910 Or abs_y = 930 _
                        Or abs_y = 950 Or abs_y = 970 Or abs_y = 990 Then
                            With tabla_consulta
                                If abs_x = 15 Then
                                    e.Graphics.DrawString(.Item(0, fila).Value & "|" & .Item(1, fila).Value, fuente_tabla_regular, Brushes.Black, abs_x, abs_y)
                                ElseIf abs_x = 135 Then
                                    e.Graphics.DrawString(.Item(4, fila).Value, fuente_tabla_regular, Brushes.Black, abs_x, abs_y)
                                ElseIf abs_x = 255 Then
                                    e.Graphics.DrawString(.Item(3, fila).Value, fuente_tabla_regular, Brushes.Black, abs_x, abs_y)
                                ElseIf abs_x = 415 Then
                                    e.Graphics.DrawString(.Item(5, fila).Value, fuente_tabla_regular, Brushes.Black, abs_x, abs_y)
                                ElseIf abs_x = 675 Then
                                    e.Graphics.DrawString(.Item(3, fila).Value, fuente_tabla_regular, Brushes.Black, abs_x, abs_y)
                                End If
                            End With
                            fila += 1
                        End If
                    End If
                Next abs_y
            Next abs_x

            'Mostrar total solo si es la última página
            If tabla_consulta.RowCount - minrow < 30 Then
                '=========================
                e.Graphics.DrawLine(trazo_grueso, 10, 1000, 790, 1000)
                ' ----- TOTAL DEUDA
                e.Graphics.DrawString("TOTAL DEUDA " & total_deuda.Text, fuente_h1, Brushes.Black, 483, 1001) 'Fecha

            End If

            'Pie de página
            e.Graphics.DrawString("Municipalidad de Villa de Las Rosas | Guasmara Este 93 | Dpto. San Javier | Córdoba", fuente_desc_cursiva, Brushes.Gray, 95, 1030)
            hoja += 1
            minrow += 30
        Loop While maxrow > minrow

    End Sub
    Private Sub vistaprevia_consulta_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles vistaprevia_consulta.Click
        'Por alguna razón el diálogo de vista previa se borra ( .Dispose() ) 
        'cuando lo cierro, así que mejor lo creo cada vez que apreto el botón "Vista Previa"
        Dim printpreview As New PrintPreviewDialog
        consulta_printdocument.DocumentName = "Consulta Impuesto"
        printpreview.Document = consulta_printdocument
        printpreview.Show()
    End Sub
    Private Sub imprimir_consulta_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles imprimir_consulta.Click
        PrintDialog.Document = consulta_printdocument
        PrintDialog.ShowDialog()
    End Sub
    '###### END PRINT ###########################################################################################


End Class

